本节笔记用于windows窗体程序的高级功能。

# Windows窗体的高级功能 #

我们知道一个Windows程序界面很少只包含一个对话框，这些应用程序一般使用单一文档界面（Single Document Interface，SDI）或多文档界面（Multiple Document Interface，MDI），这两种类型的应用程序通常会使用大量的菜单和工具栏，本章主要讨论它们。

本章首先介绍菜单控件，再介绍工具栏，说明如何把工具栏上的按钮和特定的菜单项链接起来，或者把特定的菜单项与工具栏上的按钮链接起来。接着创建SDI和MDI应用程序，主要讨论MDI应用程序，因为SDI基本上是MDI应用程序的子集。

我们前面接触的控件都是.NET Framework提供的控件。这些控件非常强大，提供了很多功能。但有时候它们还不够，所以需要创建定制的控件，本章最后就是介绍如何创建定义控件。

## 一、菜单和工具栏 ##

几乎每个Windows应用都包含菜单和工具栏。在为Windows操作系统写的程序中，菜单和工具栏可能是不可或缺的重要部分。为了帮助用户创建应用程序的菜单，VS提供了两个空间，使用它们不必做太多的工作，就可以快速创建外观类似于VS的菜单和工具栏。

### 1、两个实质一样的控件

下面介绍的这两个空间是VS2005的新增控件，它们为开发人员提供了很多强大的功能。使用这两个空间可以创建出具有工具栏和菜单的应用程序。以前需要几个星期才能完成创建的应用程序，现在变成区区数秒即可完成的简单任务。

我们要使用的控件包含在后缀为Strip的控件系列中，分别是ToolStrip、MenuStrip和StatusStrip。StatusStrip后面会详细介绍。从它们最纯粹的形式来看，ToolStrip和MenuStrip实际上是相同的控件，因为MenuStrip直接派生于ToolStrip。也就是说，ToolStrip能做的工作，MenuStrip也能完成。显然一起使用工作会完成的更好。

### 2、使用MenuStrip控件

除了MenuStrip控件之外，还有许多控件可以填充菜单。3个最常见的控件是ToolStripMenuItem、ToolStripDropDown和ToolStripSeparator。这些控件表示查看菜单或工具栏中的水平或垂直分割线。

除了MenuStrip外，还有一种菜单ContextMenuStrip。当用户右击一项时，关联菜单就会显示出来，它通常显示与该项相关的信息。

### 3、手工创建菜单

从工具箱中把Menu控件拖放到设计界面上时，该控件会位于窗体和控件盘上，而且可以直接在窗体上编辑。要创建新的菜单项，只需要把指针放在Type Here框上。

在突出显示的框中输入菜单的标题，在要用作该菜单项快捷键字符的字母前加上一个宏字符&，在菜单项中，该字母显示为下划线形式，可以按下Alt键和该字母键来选择该菜单项。

注意，可以在一个菜单中用同一快捷键字符创建好几个菜单项，其规则是每个弹出菜单只能将该字母使用一次。如果不小心把同一个快捷键字符赋予了同一个弹出菜单中的多个菜单项，则只有最靠近控件顶部的那个菜单项会相应该字符。

选择一项，控件就会自动在当前项的下面和右边显示一些项。给这两个控件输入标题，就创建了与开始时选中的项相关的一个新项，这就是创建下拉菜单的方式。

要创建水平线，把菜单分成组，必须使用ToolStripSeparator控件，而不是ToolStripMenuItem控件，但不需要插入另一个控件。还可以键入一个短横线（-），作为该项的标题。VS会自动假定该项是一个分隔符，改变控件的类型。

### 4、ToolTripMenuItem控件的其他属性

ToolStripMenuItem有另外几个属性，在创建菜单时应了解这些属性。下表不完整，如果想查阅完整列表，可参阅.NET Framework SDK文档说明。

属性 | 说明
:---:|:---:
Checked | 表示菜单是否被选中
CheckOnClick | 这个属性是true时，如果菜单项文本左边的复选框没有打上标记，就打上标记，如果该复选框已打上标记，就去除该标记，否则，该标记就被一个图像替代，使用checked属性确定菜单项的状态
Enabled | 把Enabled设置为false，菜单项就会灰显，不能被选中
DropDownItems | 这个属性返回一个项集合，用作与菜单项相关的下拉菜单

### 5、给菜单添加功能

只需在单击菜单时执行某些操作即可。这个操作取决于用户。为了响应用户做出的选择，就应为ToolStripMenuItems发送的两个事件之一提供处理程序。

事件名称 | 说明
:------:|:---:
Click | 在用户单击菜单项时，引发该事件。大多数情况下这就是要响应的事件
CheckedChanged | 当单击带CheckOnClick属性的菜单项时，引发这个事件

## 二、工具栏 ##

通过菜单可以访问应用程序中的大多数功能，把一些菜单项放在工具栏中和放在菜单中有相同的作用。工具栏提供了单击访问程序中常用功能（如open和Save）的方式。

工具栏上的按钮通常包图片，不包含文本，但它可以既包含图片又包含文本。像word中工具栏就不包含文本，在IE中的工具栏包含文本。除了按钮之外，工具栏上偶尔也会有组合框和文本框。如果把鼠标指针停留在工具栏的一个按钮上，就会显示一个工具提示，给出该按钮的用途信息，特别是只显示图标时，这是很有帮助的。

ToolStrip与MenuStrip一样，也具有专业化的外观和操作方式。在用户查看工具栏时，希望能把它移动到自己希望的任意位置上。ToolStrip就允许用户这么做。

第一次把ToolStrip添加到窗体的设计界面上时，它看起来非常类似于前面的MenuStrip，但存在两个区别：ToolStrip的最左边有4个垂直排列的点，这与VS中的菜单相同。这些点表示工具栏可以移动，也可以停靠在父应用程序窗口中。第二个区别是在默认情况下，工具栏显示的是图像，而不是文本，所以工具栏上项的默认控件是按钮。工具栏显示的下拉菜单允许选择菜单项的类型。

ToolStrip与MenuStrip完全相同的一个方面是，Action窗口包含Insert Standard Items链接。单击这个链接，不会得到和MenuStrip相同的菜单项数，而会获得New、Open、Save、Print、Cut、Copy、Paste和Help等按钮。

下面先介绍ToolStrip的一些属性和用于填充它的控件。

### 1、ToolTrip控件的属性

ToolStrip控件的属性控制和管理着控件的显示位置和显式方式。这个控件是前面介绍的MenuStrip控件的基础，所以它们具有许多相同的属性。下面只列出了几个比较重要的属性，如果需要完整的列表，可参阅.NET Framwork SDK文档说明。

属性 | 说明
:---:|:---:
GripStyle | 控制4个垂直排列的点是否显示在工具栏的最左边。隐藏手柄后，用户就不能移动工具栏了
LayoutStyle | 控制工具栏上的项如何显示，默认为水平显示
Items | 包含工具栏中所有项的集合
ShowItemToolTip | 确定是否显示工具栏上某项的工具提示
Stretch | 默认情况下，工具栏比包含在其中的项略宽或略高。如果把Stretch属性设置为true，工具栏就会占据其容器的总长

### 2、ToolTrip的项

### 3、StatusStrip控件

### 4、StatusStripStatusLabel的属性

## 三、SDI和MDI应用程序 ##

## 四、生成MDI应用程序 ##

## 五、创建控件 ##

### 1、调试用户控件

### 2、扩展LabelTextbox控件