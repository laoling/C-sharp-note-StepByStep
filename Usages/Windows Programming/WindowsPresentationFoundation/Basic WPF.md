本章笔记我们介绍些关于WPF的基础知识，我们先只停留在认识基础的程度，后面我们还会进一步深入学习WPF的相关知识。

# Windows Presentation Foundation（WPF）基础知识 #

## 一、WPF概述 ##

WPF（Windows Presentation Foundation）适用于Windows的现代图形显示系统。与之前的其他技术相比，WPF发生了根本性变化，引入了**内置硬件加速**和**分辨率无关**等创新功能，后面我们详细介绍。

如果要构建桌面模式的（Windows下的）富桌面应用程序，WPF无疑是最佳的工具包。事实上，WPF是针对Windows版本的唯一通用工具包。比较起来，Microsoft推出的Metro工具包只适用于Windows8系统。WPF的应用范围却广泛的多，它甚至可运行在仍在很多大企业中使用的Windows XP上；唯一的局限性在于您必须对Visual Studio进行配置，使其将较为陈旧的.NET Framework作为目标。

本章将首先介绍WPF的体系结构，然后讨论WPF如何处理可变屏幕分辨率，将概述WPF的核心程序集和类，并将介绍WPF如何从初始版本演变为WPF4.5。

### 1、Windows图形化演化

在WPF面世之前的十五年，Windows开发人员一直使用本质上相同的显示技术。究其原因，是由于此前的每个传统Windows应用程序都依靠Windows操作系统的如下两个由来已久的部分来创建用户界面：

* **User32**：该部分为许多元素（如窗口、按钮和文本框等）提供了熟悉的Windows外观。
* **GDI/GDI+**：该部分为渲染简单形状、文本以及图像提供了绘图支持，但增加了复杂程度（且通常性能较差）。

历经多年发展，这两种技术都得到了改进，而且开发人员使用的与其交互的API也已发生了巨大变化。但在构建应用程序时，不管是窗体还是基于MFC的C++代码，底层都是使用Windows相同部分来完成工作的。不同框架工具只是为与User32和GDI进行交互提供了不同的封装器而已。这些框架工具能提高效率，降低复杂性，并提供了更多预置特性，从而使开发人员不必再自行编写底层代码，但这些框架工具不可能消除在10年前设计的系统组件的基本限制。

##### 1.1 DirectX：新的图形引擎

针对User32和GDI库的限制Windows曾提供了一个解决方案：DirectX。DirectX起初是一个易于出错的组合性质的工具包，用于在Windows平台上开发游戏。DirectX在设计上关注的重点是速度。

为此，Windows和显卡供应商密切合作，以便为DirectX提供复杂的纹理映射、特殊效果以及三维图形所需的硬件加速功能。

现在DirectX已经历数年发展，趋于成熟。已成为Windows基本组成部分，可支持所有现代显卡。然而，DirectX编程API一直未背离设计初衷，仍主要作为游戏开发人员的工具包。因为DirectX的复杂性，它几乎从未用于开发传统类型的Windows应用程序。

Windows为了扭转这种局面。在WPF中，底层图形技术不再是GDI/GDI+，而是DirectX。也就是说，不管创建哪种用户界面，WPF应用程序在底层都是使用DirectX。

这意味着，不论设计复杂的三维图形，还是仅绘制几个按钮和纯文本，所有绘图工作都是通过DirectX管线完成的。因此，即使是最普通的商业应用程序也能使用丰富的效果，如半透明和反锯齿。在硬件加速方面也带来了好处，DirectX在渲染图形时会将尽可能多的工作递交给图形处理单元去处理。

不过，仍有一个User32组件得以保留，该组件只用于有限的范围。因为对于特定服务，WPF仍依赖于User32，如处理和路由输入信息以及区分哪个应用程序实际拥有屏幕的哪一部分。但所有绘图操作都是由DirectX完成的。

##### 1.2 硬件加速与WPF

显卡在支持特定渲染特性和优化方面是有区别的。令人感到庆幸的是，这并不是什么问题，原因有两点。

* 首先，当今大多数计算机配备的显卡硬件都足以支持3D绘图和动画等WPF功能。即使是使用集成图形处理器的便携式电脑和桌面计算机也同样如此。
* 其次，WPF为要完成的所有工作都预备了软件处理方式。这意味着，WPF的智能程度足够高，会尽量采用硬件优化方式，但如有必要，它也可采用软件方式来完成同样的工作。因此，如果在配备旧式显卡的计算机上运行WPF应用程序，界面仍将按其设计方式显示。当然速度会慢很多，且不能流畅运行富WPF应用程序。

### 2、WPF：高级API

如果WPF仅通过DirectX提供硬件加速功能，那么它只能算一项重要改进，而不是革命性变化。实际上，WPF包含了一整套面向应用程序编程人员的高级服务。

下面列出WPF引入到Windows编程领域中的一些最重要变化：

* 类似Web的布局模型。与通过特性坐标将控件固定在具体位置不同，WPF十分注重灵活的流式布局，根据控件的内容灵活地排列控件，从而使用户界面能适应变化幅度大的内容以及不同的语言。
* 丰富的绘图模型。与逐像素进行绘制不同，在WPF中可直接处理图元——基本形状、文本块以及其他图形元素。也可使用其他新特性，如真正的透明控件、放置多层并具有不同透明度内容的功能以及本地3D支持。
* 丰富的文本模型。WPF为Windows应用程序提供了在用户界面的任何位置显示丰富的样式化文本的功能。甚至可将文本和列表、浮动的图形以及其他用户界面元素结合起来。并且如果需要显示大量文本，还可使用高级的文档显示特性，例如换行、分列和对齐，以提高可读性。
* 作为首要编程概念的动画。在WPF中，不必再用计时器来强制窗体重绘自身。与此相反，动画成为WPF框架的固有部分。在WPF中可使用声明式标签定义动画，WPF会自动让他们运动起来。
* 支持音频和视频媒体。以前的用户界面开发工具包对多媒体的处理有很大的限制。但WPF支持播放任何Windows媒体播放器所支持的音频和视频文件，并允许同时播放多个媒体文件。更引人注目的是，WPF提供了允许在用户界面的其他部分集成视频内容的工具，还允许添加特效技巧。
* 样式和模板。通过样式可实现显示格式的标准化，并可在整个应用程序中反复使用。通过模板可改变元素的渲染方式，甚至改变核心控件的渲染方式。在创建现代的具有皮肤的用户界面时，从来都不像现在这样方便。
* 命令。大多数用户已认识到，通过菜单或工具栏触发Open命名并没有什么区别，最终结果是相同的。现在通过代码抽象，可在特定位置定义应用程序命名并将其链接到多个控件上。
* 声明式用户界面。尽管可编写代码来创建WPF窗口，但VS提供了另一种方式。它将每个窗口的内容串行化到XAML文档中的一组XML标签中。其优点是用户界面和代码完全分离，并且图形设计人员可使用专业工具编辑XAML，并最终润色应用程序的前端界面。XAML是Extensible Application Markup Language的缩写。
* 基于页面的应用程序。可使用WPF创建类似于浏览器的应用程序，此类应用程序可通过前进后退导航按钮在一组页面中移动。由WPF来处理那些纷繁的细节，如页面历史。甚至可将项目部署为运行与IE中的基于浏览器的应用程序。

### 3、分辨率无关性

### 4、WPF体系结构

### 5、WPF4.5

## 二、XAML ##

## 三、布局（Layout） ##

